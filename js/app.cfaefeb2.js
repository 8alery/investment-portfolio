(function(t){function e(e){for(var a,s,i=e[0],c=e[1],u=e[2],l=0,f=[];l<i.length;l++)s=i[l],o[s]&&f.push(o[s][0]),o[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);d&&d(e);while(f.length)f.shift()();return n.push.apply(n,u||[]),r()}function r(){for(var t,e=0;e<n.length;e++){for(var r=n[e],a=!0,i=1;i<r.length;i++){var c=r[i];0!==o[c]&&(a=!1)}a&&(n.splice(e--,1),t=s(s.s=r[0]))}return t}var a={},o={app:0},n=[];function s(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=a,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(r,a,function(e){return t[e]}.bind(null,a));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/investment-portfolio/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var d=c;n.push([1,"chunk-vendors"]),r()})({0:function(t,e){},1:function(t,e,r){t.exports=r("56d7")},"1cbc":function(t,e,r){"use strict";r.r(e);var a=r("795b"),o=r.n(a),n=(r("ac6a"),r("5d73")),s=r.n(n),i=r("2ef0"),c=r.n(i),u=r("2b0e"),d=r("2e70"),l=function(t,e){var r=!0,a=!1,o=void 0;try{for(var n,i=s()(c.a.keys(e));!(r=(n=i.next()).done);r=!0){var d=n.value;u["a"].set(t,d,e[d])}}catch(l){a=!0,o=l}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}},f={};e["default"]={state:{loading:!1,items:[],bondsCache:{},selectedBoard:"TQOB",searchText:"",boards:[],currentPage:1,perPage:20,sortBy:"marketData.YIELD",sortDesc:!0},getters:{bonds:function(t){return t.items},bondsBoards:function(t){return t.boards},bondsCache:function(t){return t.bondsCache}},mutations:{"bonds.set":function(t,e){t.items=e},"bonds.update":function(t,e){t.bondsCache[e.id]?l(t.bondsCache[e.id],e):u["a"].set(t.bondsCache,e.id,e)},"bondsBoards.set":function(t,e){t.boards=e},"bonds.selectedBoard":function(t,e){t.selectedBoard=e},"bonds.searchText":function(t,e){t.searchText=e},"bonds.currentPage":function(t,e){t.currentPage=e},"bonds.perPage":function(t,e){t.perPage=e},"bonds.sortBy":function(t,e){t.sortBy=e},"bonds.sortDesc":function(t,e){t.sortDesc=e},"bonds.loading":function(t,e){t.loading=e}},actions:{changeBondsSelectedBoard:function(t,e){var r=t.commit,a=t.dispatch;r("bonds.selectedBoard",e),r("bonds.set",[]),f.getBonds=null,a("getBonds")},getBonds:function(t){var e=t.commit,r=t.state;return f.getBonds||(f.getBonds=new o.a(function(t,a){e("bonds.loading",!0),d["a"].getSecuritiesForMarketAndBoard({market:"bonds",board:r.selectedBoard}).then(function(t){e("bonds.set",t),e("bonds.loading",!1)},a)})),f.getBonds},getBond:function(t,e){var r=t.state,a=t.commit;return new o.a(function(t,o){return r.bondsCache[e]?t(r.bondsCache[e]):d["a"].getBond(e).then(function(o){return a("bonds.update",o),t(r.bondsCache[e])},o)})},getBondsBoards:function(t){var e=t.commit;return f.getBoardsForMarket||(f.getBoardsForMarket=new o.a(function(t,r){d["a"].getBoardsForMarket("bonds").then(function(t){e("bondsBoards.set",t)},r)})),f.getBoardsForMarket}}}},2:function(t,e){},"2a74":function(t,e,r){"use strict";r.r(e);r("a481"),r("ac6a");var a=r("d307"),o={};a.keys().forEach(function(t){"./index.js"!==t&&(o[t.replace(/(\.\/|\.js)/g,"")]=a(t).default)}),e["default"]=o},"2e70":function(t,e,r){"use strict";var a=r("768b"),o=(r("ac6a"),r("5df3"),r("7514"),r("795b")),n=r.n(o),s=r("bd86"),i=r("cebc"),c=r("bc3a"),u=r.n(c),d=r("2ef0"),l=r.n(d),f=function(t,e){return l.a.reduce(t,function(t,r,a){var o=e[a];return Object(i["a"])({},t,Object(s["a"])({},o,r))},{})},m=function(t,e,r){var a={};return l.a.each(e,function(e,o){-1!==l.a.indexOf(t,e)&&(a[e]=r[o])}),a};e["a"]={getSecuritiesForMarketAndBoard:function(t){var e=t.market,r=t.board;return u.a.get("https://iss.moex.com/iss/engines/stock/markets/".concat(e,"/boards/").concat(r,"/securities.json")).then(function(t){if(200!==t.status)return n.a.reject(t.statusText);var e=t.data,r=e.securities,a=e.marketdata,o=[];return l.a.each(r.data,function(t){var e=f(t,r.columns);o.push({id:e.SECID,details:l.a.omit(e,"SECID"),marketData:{}})}),l.a.each(a.data,function(t){var e=f(t,a.columns),r=l.a.find(o,function(t){return t.id===e.SECID});r.marketData=e}),o})},getBond:function(t){return n.a.all([u.a.get("https://iss.moex.com/iss/securities/".concat(t,".json")).then(function(t){if(200!==t.status)return n.a.reject(t.statusText);var e=t.data,r=e.description,a=e.boards,o=l.a.reduce(r.data,function(t,e){return Object(i["a"])({},t,Object(s["a"])({},e[0],e[2]))},{}),c=l.a.reduce(a.data,function(t,e){return Object(i["a"])({},t,Object(s["a"])({},e[1],f(e,a.columns)))},{});return{info:o,boards:c}}),u.a.get("https://iss.moex.com/iss/statistics/engines/stock/markets/bonds/bondization/".concat(t,".json"),{params:{start:0,limit:100,"iss.meta":"off",sort_order:"asc"}}).then(function(t){if(200!==t.status)return n.a.reject(t.statusText);var e=t.data,r=e.amortizations,a=e.coupons,o=e.offers,s={amortizations:[],coupons:[],offers:[]};return l.a.each(r.data,function(t){var e=m(["amortdate","initialfacevalue","value","data_source"],r.columns,t);s.amortizations.push(e)}),l.a.each(a.data,function(t){var e=m(["coupondate","recorddate","startdate","facevalue","initialfacevalue","value","data_source"],a.columns,t);s.coupons.push(e)}),l.a.each(o.data,function(t){var e=m(["offerdate","offerdatestart","offerdateend","facevalue","price","value","agent","offertype"],o.columns,t);s.offers.push(e)}),s})]).then(function(e){var r=Object(a["a"])(e,2),o=r[0],n=o.info,s=o.boards,i=r[1];return{id:t,info:n,boards:s,payments:i}})},getBoardsForMarket:function(t){return u.a.get("https://iss.moex.com/iss/engines/stock/markets/".concat(t,"/boards.json")).then(function(t){if(200!==t.status)return n.a.reject(t.statusText);var e=t.data.boards,r=[];return l.a.each(e.data,function(t){r.push(f(t,e.columns))}),r})},getShare:function(t){return n.a.all([u.a.get("https://iss.moex.com/iss/securities/".concat(t,".json")).then(function(t){if(200!==t.status)return n.a.reject(t.statusText);var e=t.data,r=e.description,a=e.boards,o=l.a.reduce(r.data,function(t,e){return Object(i["a"])({},t,Object(s["a"])({},e[0],e[2]))},{}),c=l.a.reduce(a.data,function(t,e){return Object(i["a"])({},t,Object(s["a"])({},e[1],f(e,a.columns)))},{});return{info:o,boards:c}})]).then(function(e){var r=Object(a["a"])(e,1),o=r[0],n=o.info,s=o.boards;return{id:t,info:n,boards:s}})}}},3:function(t,e){},3150:function(t,e,r){"use strict";r.r(e),e["default"]={state:{bonds:{filter:{board:"TQOB"},searchText:"",currentPage:1,perPage:20,sortBy:"marketData.YIELD",sortDesc:!0,kind:"federal"}},mutations:{"layout.bonds.filter.board":function(t,e){t.bonds.filter.board=e},"layout.bonds.searchText":function(t,e){t.bonds.searchText=e},"layout.bonds.currentPage":function(t,e){t.bonds.currentPage=e},"layout.bonds.perPage":function(t,e){t.bonds.perPage=e},"layout.bonds.sortBy":function(t,e){t.bonds.sortBy=e},"layout.bonds.sortDesc":function(t,e){t.bonds.sortDesc=e},"layout.bonds.kind":function(t,e){t.bonds.kind=e}}}},4678:function(t,e,r){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-SG":"cdab","./en-SG.js":"cdab","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-nz":"6f50","./en-nz.js":"6f50","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-tw":"90ea","./zh-tw.js":"90ea"};function o(t){var e=n(t);return r(e)}function n(t){var e=a[t];if(!(e+1)){var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}return e}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="4678"},"56d7":function(t,e,r){"use strict";r.r(e);var a=r("2b0e"),o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("div",{attrs:{id:"nav"}},[r("router-link",{attrs:{to:"/bonds"}},[t._v("Облигации")]),t._v(" |\n    "),r("router-link",{attrs:{to:"/shares"}},[t._v("Акции")]),t._v(" |\n    "),r("router-link",{attrs:{to:"/portfolio"}},[t._v("Портфель")])],1),r("router-view")],1)},n=[],s=(r("5c0b"),r("2877")),i={},c=Object(s["a"])(i,o,n,!1,null,null,null),u=c.exports,d=r("8c4f"),l=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{staticClass:"bonds",attrs:{fluid:""}},[r("b-form",[r("b-form-row",{staticClass:"mb-2"},[r("b-col",{attrs:{cols:"auto"}},[r("b-form-select",{attrs:{options:t.bondBoards},model:{value:t.board,callback:function(e){t.board=e},expression:"board"}})],1),r("b-col",[r("b-form-input",{attrs:{placeholder:"Поиск..."},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),r("b-col",{attrs:{cols:"auto"}},[r("b-button",{staticClass:"btn btn-success",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.exportData(e)}}},[r("fa-icon",{attrs:{icon:"file-excel"}}),r("span",{staticClass:"ml-2"},[t._v("Экспорт в Excel")])],1)],1)],1)],1),r("b-table",{attrs:{striped:"",hover:"",id:"bonds",busy:t.loading,"no-local-sorting":!0,fields:t.fields,"sort-by":t.sortBy,"sort-desc":t.sortDesc,items:t.itemsVisible,small:""},on:{"row-clicked":t.viewItem,"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e}}},[r("div",{staticClass:"text-center text-success my-2",attrs:{slot:"table-busy"},slot:"table-busy"},[r("b-spinner",{staticClass:"align-middle"}),r("strong",[t._v("Загрузка...")])],1)]),r("b-row",[r("b-col",[r("b-pagination",{attrs:{"per-page":t.perPage,"total-rows":t.rows},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1)},f=[],m=r("f499"),h=r.n(m),b=r("75fc"),p=(r("ac6a"),r("3b2b"),r("c1df")),v=r.n(p),y=r("2ef0"),g=r.n(y),k=r("66e2"),j=r("1146"),D=r.n(j),B=r("7801"),P=r("1a67"),O=r("600e"),C=r("ee9e"),x=r("7f7d"),w=r("16db"),T=r("2f2c"),E=r("5572"),F=r("362b"),$=r("e591"),S={SUR:"₽",USD:"$",EUR:"€"},M={name:"Bonds",components:{BRow:$["a"],BPagination:F["a"],BFormSelect:E["a"],BSpinner:T["a"],BFormRow:w["a"],BFormInput:x["a"],BForm:C["a"],BTable:O["a"],BCol:P["a"],BContainer:B["a"],BButton:k["a"]},data:function(){return{usefulBoards:[{value:"TQOB",text:"Т+: Облигации - безадрес."},{value:"TQOD",text:"Т+: Облигации (USD) - безадрес."},{value:"EQOB",text:"Т0 Облигации - безадрес."},{value:"EQDB",text:"Основной режим: Облигации Д - безадрес."},{value:"EQEO",text:"Основной режим: Облигации (EUR) - безадрес."}],fields:[{key:"details.BOARDID",label:"Режим",formatter:function(t,e,r){return r.details.BOARDID},sortable:!0},{key:"details.SHORTNAME",label:"Название",formatter:function(t,e,r){return r.details.SHORTNAME},sortable:!0},{key:"marketData.YIELD",label:"Доходность",formatter:function(t,e,r){return r.marketData.YIELD},sortable:!0},{key:"details.COUPONVALUE",label:"Купон",formatter:function(t,e,r){return r.details.COUPONVALUE},sortable:!0},{key:"details.NEXTCOUPON",label:"Дата купона",formatter:function(t,e,r){return v()(r.details.NEXTCOUPON).format("DD.MM.YYYY")},sortable:!0},{key:"details.MATDATE",label:"Дата погашения",formatter:function(t,e,r){return v()(r.details.MATDATE).format("DD.MM.YYYY")},sortable:!0},{key:"details.COUPONPERCENT",label:"Купон %",formatter:function(t,e,r){return r.details.COUPONPERCENT},sortable:!0},{key:"details.COUPONPERIOD",label:"Период выплаты",formatter:function(t,e,r){return r.details.COUPONPERIOD},sortable:!0},{key:"marketData.MARKETPRICE",label:"Рыночная цена",formatter:function(t,e,r){return r.marketData.MARKETPRICE},sortable:!0},{key:"lot",label:"Лот",formatter:function(t,e,r){return"".concat(r.details.LOTSIZE*r.details.FACEVALUE," ").concat(S[r.details.FACEUNIT])},sortable:!0},{key:"details.ISIN",label:"ISIN",formatter:function(t,e,r){return r.details.ISIN},sortable:!0}],bondsGroups:[{value:"custom",text:"Режим торгов"},{value:"federal",text:"ОФЗ"},{value:"municipal",text:"Муниципальный"},{value:"corporate",text:"Корпоративные"},{value:"euroFederal",text:"ЕвроГос"},{value:"euro",text:"Еврооблигации"}]}},computed:{loading:function(){return this.$store.state.bonds.loading},board:{get:function(){return this.$store.state.bonds.selectedBoard},set:function(t){this.$store.dispatch("changeBondsSelectedBoard",t)}},searchText:{get:function(){return this.$store.state.bonds.searchText},set:function(t){this.$store.commit("bonds.searchText",t)}},currentPage:{get:function(){return this.$store.state.bonds.currentPage},set:function(t){this.$store.commit("bonds.currentPage",t)}},perPage:{get:function(){return this.$store.state.bonds.perPage},set:function(t){this.$store.commit("bonds.perPage",t)}},sortBy:{get:function(){return this.$store.state.bonds.sortBy},set:function(t){this.$store.commit("bonds.sortBy",t)}},sortDesc:{get:function(){return this.$store.state.bonds.sortDesc},set:function(t){this.$store.commit("shares.sortDesc",t)}},items:function(){return this.$store.getters.bonds},itemsFiltered:function(){var t=this.items;if(this.searchText){var e=new RegExp("".concat(this.searchText),"i");t=g.a.filter(t,function(t){return e.test(t.details.SHORTNAME)||e.test(t.details.SECNAME)||e.test(t.details.ISIN)})}return t="lot"!==this.sortBy?g.a.orderBy(t,[this.sortBy],[this.sortDesc?"desc":"asc"]):g.a.orderBy(t,[function(t){return t.details.LOTSIZE*t.details.FACEVALUE}],[this.sortDesc?"desc":"asc"]),t},itemsVisible:function(){var t=(this.currentPage-1)*this.perPage;return this.itemsFiltered.slice(t,t+this.perPage)},rows:function(){return this.itemsFiltered.length},bondBoards:function(){return g.a.map(this.$store.getters.bondsBoards,function(t){return{value:t.boardid,text:t.title}})}},created:function(){this.$store.dispatch("getBonds"),this.$store.dispatch("getBondsBoards")},watch:{"filter.board":function(){this.currentPage=1},searchText:function(){this.currentPage=1},sortBy:function(t){console.log("sort by: ",t)},sortDesc:function(t){console.log("sort Desc: ",t)}},methods:{exportData:function(){if(0!==this.bonds.length){var t=D.a.utils.book_new(),e="Облигации",r=g.a.keys(g.a.first(this.bonds)),a=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/,o=[r].concat(Object(b["a"])(g.a.map(this.bonds,function(t){return g.a.map(r,function(e){return g.a.isObject(t[e])||g.a.isArray(t[e])?h()(t[e]):g.a.isString(t[e])&&a.test(t[e])?new Date(t[e]):t[e]})}))),n=D.a.utils.aoa_to_sheet(o);D.a.utils.book_append_sheet(t,n,e),D.a.writeFile(t,"Облигации.xlsx")}},viewItem:function(t){this.$router.push({name:"viewBond",params:{secid:t.id,board:t.details.BOARDID}})}}},Y=M,I=Object(s["a"])(Y,l,f,!1,null,null,null),A=I.exports,R=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{staticClass:"bonds"},[r("b-row",{staticClass:"mb-3"},[r("b-col",{attrs:{cols:"auto"}},[r("b-button",{attrs:{variant:"outline-primary"},on:{click:t.addToPortfolio}},[r("fa-icon",{staticClass:"mr-2",attrs:{icon:"briefcase"}}),r("span",[t._v("Добавить в портфель")])],1)],1)],1),r("b-row",[r("b-col",{attrs:{cols:"8"}},[r("b-tabs",[r("b-tab",{class:{active:"details"==t.selectedSection},attrs:{title:"Общие сведения"},on:{click:function(e){t.selectedSection="details"}}},[r("b-table",{attrs:{striped:"",hover:"",items:t.details}})],1),r("b-tab",{class:{active:"marketData"==t.selectedSection},attrs:{title:"Рыночная информация"},on:{click:function(e){t.selectedSection="marketData"}}},[r("b-table",{attrs:{striped:"",hover:"",items:t.marketData}})],1),r("b-tab",{class:{active:"calculateYield"==t.selectedSection},attrs:{title:"Расчет доходности"},on:{click:function(e){t.selectedSection="calculateYield"}}},[r("b-form",{on:{submit:function(e){return e.preventDefault(),t.calculateYield(e)}}},[r("b-form-group",{attrs:{label:"Цена"}},[r("b-form-input",{attrs:{id:"input-1",type:"number",step:"any",placeholder:"100%"},model:{value:t.targetPrice,callback:function(e){t.targetPrice=e},expression:"targetPrice"}})],1),r("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Рассчитать")])],1),r("div",[t._v("Доходность: "+t._s(t.effectiveYield))]),r("div",[t._v("НКД: "+t._s(t.nkd))])],1)],1)],1),r("b-col",{attrs:{cols:"4"}},[r("b-tabs",[r("b-tab",{class:{active:"coupons"==t.selectedTab},attrs:{title:"Купоны"},on:{click:function(e){t.selectedTab="coupons"}}},[r("b-table",{attrs:{striped:"",hover:"","tbody-tr-class":t.couponRowClass,fields:t.couponsFields,items:t.coupons}})],1),r("b-tab",{class:{active:"amortizations"==t.selectedTab},attrs:{title:"Амортизации"},on:{click:function(e){t.selectedTab="amortizations"}}},[r("b-table",{attrs:{striped:"",hover:"","tbody-tr-class":t.amortizationRowClass,items:t.amortizations,fields:t.amortizationsFields}})],1),r("b-tab",{class:{active:"offers"==t.selectedTab},attrs:{title:"Оферты"},on:{click:function(e){t.selectedTab="offers"}}},[r("b-table",{attrs:{striped:"",hover:"",items:t.offers}})],1)],1)],1)],1)],1)},z=[],N=r("5d73"),U=r.n(N),L=r("0a0d"),V=r.n(L),K=r("59ad"),G=r.n(K),H=r("e814"),Q=r.n(H),q=1e-5,Z={roundFloat:function(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r},xiff:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=v()(),o=0,n=g.a.map(e,function(){return 0}),s=0;s<e.length;s+=1){var i=v()(e[s].date).diff(a,"days")/365;n[s]=i,o+=e[s].amount/Math.pow(1+r,i)}if(o-=t,o<0)do{r-=q,o=0;for(var c=0;c<e.length;c+=1)o+=e[c].amount/Math.pow(1+r,n[c]);o-=t}while(o<=0);else do{r+=q,o=0;for(var u=0;u<e.length;u+=1)o+=e[u].amount/Math.pow(1+r,n[u]);o-=t}while(o>=0);return r},calculateNKD:function(t,e){t=v()(t);for(var r=g.a.first(e.payments.coupons),a=null,o=1;o<e.payments.coupons.length;o+=1){if(a=e.payments.coupons[o],v()(a.coupondate).diff(t,"days")>0)break;r=a}var n=t.diff(r.coupondate,"days"),s=v()(a.coupondate).diff(r.coupondate,"days");return this.roundFloat(a.value*n/s,2)},calculateYieldForPrice:function(t,e,r){e=e.getTime();var a=r.payments.amortizations;a.length>1&&(a=g.a.filter(r.payments.amortizations,function(t){return v()(t.amortdate).valueOf()>e&&"amortization"===t.data_source})),a=g.a.map(a,function(t){return{date:v()(t.amortdate).valueOf(),amount:t.value}}),a=g.a.sortBy(a,"date");var o=g.a.filter(r.payments.coupons,function(t){return v()(t.coupondate).valueOf()>e});o=g.a.map(o,function(t){return{date:v()(t.coupondate).valueOf(),amount:t.value}}),o=g.a.sortBy(o,"date");var n=[].concat(Object(b["a"])(a),Object(b["a"])(o));n=g.a.groupBy(n,"date");var s=g.a.sortBy(g.a.keys(n));n=g.a.map(s,function(t){return{date:v()(Q()(t,10)),amount:g.a.reduce(n[t],function(t,e){return t+e.amount},0)}});var i=G()(r.info.FACEVALUE),c=i*t/100,u=this.calculateNKD(e,r),d=this.xiff(c+u,n,r.marketData.YIELD);return{nkd:u,yieldToMaturity:this.roundFloat(100*d,2)}},getBondPaymentsForPeriod:function(t){var e=t.bond,r=t.from,a=t.to;if(!e||!e.payments||!r||!a)return[];var o=e.payments,n=o.amortizations,s=o.coupons;if(!n||!s)return[];r=v()(r).toDate(),a=v()(a).toDate();var i=[],c=!0,u=!1,d=void 0;try{for(var l,f=U()(s);!(c=(l=f.next()).done);c=!0){var m=l.value,h=v()(m.coupondate).toDate();h>=r&&h<a&&i.push({date:h,type:"coupon",value:m.value})}}catch(P){u=!0,d=P}finally{try{c||null==f.return||f.return()}finally{if(u)throw d}}if(1===n.length){var b=v()(n[0].amortdate).toDate();b>=r&&b<a&&i.push({date:date,type:"amortization",value:n[0].value})}else{var p=!0,y=!1,g=void 0;try{for(var k,j=U()(n);!(p=(k=j.next()).done);p=!0){var D=k.value;if("maturation"!==D.data_source){var B=v()(D.amortdate).toDate();B>=r&&B<a&&i.push({date:B,type:"amortization",value:D.value})}}}catch(P){y=!0,g=P}finally{try{p||null==j.return||j.return()}finally{if(y)throw g}}}return i},calculateOwnershipForPayments:function(t){var e=t.payments,r=t.orders,a=g.a.map(r,function(t){return{date:v()(t.purchaseDate).toDate(),amount:t.amount}}),o=!0,n=!1,s=void 0;try{for(var i,c=function(){var t=i.value,e=g.a.filter(a,function(e){return e.date<=t.date}),r=g.a.reduce(e,function(t,e){return t+e.amount},0);t.amount=r,t.total=t.value*r},u=U()(e);!(o=(i=u.next()).done);o=!0)c()}catch(d){n=!0,s=d}finally{try{o||null==u.return||u.return()}finally{if(n)throw s}}}},J=r("5bc8"),X=r("729c"),W=r("8807"),tt={name:"ViewBond",components:{BFormInput:x["a"],BFormGroup:W["a"],BForm:C["a"],BTab:X["a"],BTabs:J["a"],BButton:k["a"],BCol:P["a"],BRow:$["a"],BTable:O["a"]},data:function(){return{params:{isin:null,name:null,nextCouponDate:v()(),maturationDate:v()(),frequency:2,coupon:0,pricePercent:100,faceValue:1e3,rate:0,periods:[],YTM:null,hasAmortization:!1,amortizations:[]},fields:[{key:"date",label:"Дата",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"money",label:"Купон",formatter:"roundFloat"},{key:"price",label:"Цена",formatter:"roundFloat"},{key:"nkd",label:"НКД",formatter:"roundFloat"},{key:"amortization",label:"Амортизация"}],moneyFlowFields:[{key:"date",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"coupon"},{key:"period"}],selectedTab:"coupons",amortizationsFields:[{key:"amortdate",label:"Дата",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"value",label:"Значение"},{key:"data_source",label:"Тип"}],couponsFields:[{key:"coupondate",label:"Дата",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"value",label:"Значение"}],selectedSection:"calculateYield",targetPrice:100,effectiveYield:0,nkd:0}},computed:{secid:function(){return this.$route.params.secid},board:function(){return this.$route.params.board},item:function(){return this.$store.getters.bondsCache[this.secid]},details:function(){var t=this;return this.item&&g.a.map(g.a.keys(this.item.info),function(e){return{key:e,value:t.item.info[e]}})},marketData:function(){var t=this;return this.item&&this.item.boards[this.board]&&g.a.map(g.a.keys(this.item.boards[this.board]),function(e){return{key:e,value:t.item.boards[t.board][e]}})},amortizations:function(){return this.item&&this.item.payments&&this.item.payments.amortizations},coupons:function(){return this.item&&this.item.payments&&this.item.payments.coupons},offers:function(){return this.item&&this.item.payments&&this.item.payments.offers},closestAmortizationDate:function(){var t=V()(),e=!0,r=!1,a=void 0;try{for(var o,n=U()(this.amortizations);!(e=(o=n.next()).done);e=!0){var s=o.value;if(v()(s.amortdate).valueOf()>=t)return s.amortdate}}catch(i){r=!0,a=i}finally{try{e||null==n.return||n.return()}finally{if(r)throw a}}return null},closestCouponDate:function(){var t=V()(),e=!0,r=!1,a=void 0;try{for(var o,n=U()(this.coupons);!(e=(o=n.next()).done);e=!0){var s=o.value;if(v()(s.coupondate).valueOf()>=t)return s.coupondate}}catch(i){r=!0,a=i}finally{try{e||null==n.return||n.return()}finally{if(r)throw a}}return null}},created:function(){this.secid&&this.$store.dispatch("getBond",this.secid)},methods:{addToPortfolio:function(){var t=this;this.$store.dispatch("addOrder",{secid:this.secid,market:"bonds"}).then(function(e){t.$router.push({name:"editPortfolio",params:{id:e.id}})})},amortizationRowClass:function(t){if(t)return t.amortdate===this.closestAmortizationDate?"table-success":void 0},couponRowClass:function(t){if(t)return t.coupondate===this.closestCouponDate?"table-success":void 0},calculateYield:function(){var t=Z.calculateYieldForPrice(this.targetPrice,new Date,this.item),e=t.yieldToMaturity,r=t.nkd;this.effectiveYield=e,this.nkd=r}}},et=tt,rt=Object(s["a"])(et,R,z,!1,null,null,null),at=rt.exports,ot=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",{attrs:{fluid:""}},[r("b-row",[r("b-col",{attrs:{cols:"auto"}},[r("b-pagination",{attrs:{"total-rows":t.rows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),r("b-col",{attrs:{cols:"auto"}},[r("b-form-select",{attrs:{options:t.sharesBoards},model:{value:t.board,callback:function(e){t.board=e},expression:"board"}})],1),r("b-col",[r("b-form-input",{attrs:{placeholder:"Поиск..."},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}})],1),r("b-col",{attrs:{cols:"auto"}},[r("b-button",{staticClass:"btn btn-success",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.exportData(e)}}},[r("fa-icon",{attrs:{icon:"file-excel"}}),r("span",{staticClass:"ml-2"},[t._v("Экспорт в Excel")])],1)],1)],1),r("b-table",{attrs:{striped:"",hover:"",id:"shares",busy:t.loading,"no-local-sorting":!0,fields:t.fields,"sort-by":t.sortBy,"sort-desc":t.sortDesc,items:t.itemsVisible,small:""},on:{"row-clicked":t.viewItem,"update:sortBy":function(e){t.sortBy=e},"update:sort-by":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:sort-desc":function(e){t.sortDesc=e}}},[r("div",{staticClass:"text-center text-success my-2",attrs:{slot:"table-busy"},slot:"table-busy"},[r("b-spinner",{staticClass:"align-middle"}),r("strong",[t._v("Загрузка...")])],1)])],1)},nt=[],st={SUR:"₽",USD:"$",EUR:"€"},it={name:"Shares",components:{BButton:k["a"],BFormInput:x["a"],BFormSelect:E["a"],BCol:P["a"],BRow:$["a"],BPagination:F["a"],BTable:O["a"],BContainer:B["a"]},data:function(){return{fields:[{key:"details.BOARDID",label:"Режим",formatter:function(t,e,r){return r.details.BOARDID},sortable:!0},{key:"details.SHORTNAME",label:"Название",formatter:function(t,e,r){return r.details.SHORTNAME},sortable:!0},{key:"marketData.MARKETPRICE",label:"Рыночная цена",formatter:function(t,e,r){return r.marketData.MARKETPRICE},sortable:!0},{key:"lot",label:"Лот",formatter:function(t,e,r){return"".concat(r.details.LOTSIZE*r.details.FACEVALUE," ").concat(st[r.details.FACEUNIT])},sortable:!0},{key:"details.ISIN",label:"ISIN",formatter:function(t,e,r){return r.details.ISIN},sortable:!0}]}},computed:{items:function(){return this.$store.getters.shares},itemsFiltered:function(){var t=this.items;if(this.searchText){var e=new RegExp("".concat(this.searchText),"i");t=g.a.filter(t,function(t){return e.test(t.SHORTNAME)})}return t=g.a.orderBy(t,[this.sortBy],[this.sortDesc?"desc":"asc"]),t},itemsVisible:function(){var t=(this.currentPage-1)*this.perPage;return this.itemsFiltered.slice(t,t+this.perPage)},rows:function(){return this.itemsFiltered.length},sharesBoards:function(){return g.a.map(this.$store.getters.sharesBoards,function(t){return{value:t.boardid,text:t.title}})},loading:function(){return this.$store.state.bonds.loading},board:{get:function(){return this.$store.state.shares.selectedBoard},set:function(t){this.$store.dispatch("changeSharesSelectedBoard",t)}},searchText:{get:function(){return this.$store.state.shares.searchText},set:function(t){this.$store.commit("shares.searchText",t)}},currentPage:{get:function(){return this.$store.state.shares.currentPage},set:function(t){this.$store.commit("shares.currentPage",t)}},perPage:{get:function(){return this.$store.state.shares.perPage},set:function(t){this.$store.commit("shares.perPage",t)}},sortBy:{get:function(){return this.$store.state.shares.sortBy},set:function(t){this.$store.commit("shares.sortBy",t)}},sortDesc:{get:function(){return this.$store.state.shares.sortDesc},set:function(t){this.$store.commit("shares.sortDesc",t)}}},watch:{"filter.board":function(){this.currentPage=1},searchText:function(){this.currentPage=1}},created:function(){this.$store.dispatch("getShares"),this.$store.dispatch("getSharesBoards")},methods:{viewItem:function(t){this.$router.push({name:"viewShare",params:{secid:t.SECID}})}}},ct=it,ut=Object(s["a"])(ct,ot,nt,!1,null,"0c58df28",null),dt=ut.exports,lt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div")},ft=[],mt={name:"ViewShare"},ht=mt,bt=Object(s["a"])(ht,lt,ft,!1,null,"287b97ad",null),pt=bt.exports,vt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[t.item?r("b-form",{on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[r("b-row",[r("b-col",{attrs:{cols:"8"}},[r("b-form-group",{attrs:{id:"amountGroup",label:"Количество:","label-for":"amount"}},[r("b-form-input",{attrs:{id:"amount",type:"number"},model:{value:t.item.amount,callback:function(e){t.$set(t.item,"amount",t._n(e))},expression:"item.amount"}})],1),r("b-form-group",{attrs:{id:"priceGroup",label:"Цена покупки:","label-for":"price"}},[r("b-form-input",{attrs:{step:"any",id:"price",type:"number"},model:{value:t.item.price,callback:function(e){t.$set(t.item,"price",t._n(e))},expression:"item.price"}})],1),r("b-form-group",{attrs:{id:"purchaseDateGroup",label:"Дата покупки:","label-for":"purchaseDate"}},[r("datepicker",{attrs:{id:"purchaseDate",value:t.purchaseDate,format:"dd.MM.yyyy",name:"purchaseDate"},on:{input:function(e){return t.setDate("purchaseDate",e)}}})],1),r("b-button",{staticClass:"mt-4",attrs:{type:"submit",variant:"primary"}},[t._v("Сохранить")]),r("b-button",{staticClass:"mt-4 ml-2",attrs:{type:"button",variant:"danger"},on:{click:t.deleteItem}},[t._v("Удалить")])],1),r("b-col",{attrs:{cols:"4"}},[r("div",[t._v("Инструмент: "+t._s(t.bond.SHORTNAME))])])],1)],1):t._e()],1)},yt=[],gt=r("fa33"),kt={name:"EditPortfolioOrder",components:{Datepicker:gt["a"]},data:function(){return{item:null,flowFields:[{key:"date",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"coupon",formatter:function(t){return Math.round(100*t)/100}}]}},computed:{id:function(){return this.$route.params.id},bond:function(){return this.$store.getters.bondsCache[this.item.secid]||{}},nextCouponDate:function(){var t=v()(this.bond.maturationDate),e=t,r=v()(),a=Math.floor(365/this.bond.frequency);while(t.diff(r,"days")>0)e=v()(t),t=t.add(-1*a,"days");return e.format("DD.MM.YYYY")},purchaseDate:function(){return this.item.purchaseDate&&v()(this.item.purchaseDate).toDate()}},created:function(){var t=this;this.$store.dispatch("getOrder",this.id).then(function(e){t.item=_.extend({price:0},e),t.$store.dispatch("bonds.get",e.secid)})},methods:{setDate:function(t,e){this.item[t]=v()(e).toDate()},save:function(){var t=this;this.$store.dispatch("updateOrder",this.item).then(function(){t.$router.push("/portfolio")})},deleteItem:function(){var t=this;this.$store.dispatch("deleteOrder",this.item.id).then(function(){t.$router.push("/portfolio")})}}},jt=kt,Dt=(r("f898"),Object(s["a"])(jt,vt,yt,!1,null,null,null)),Bt=Dt.exports,Pt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[r("b-row",{staticClass:"mb-3"},[r("b-col",[r("b-link",{staticClass:"btn btn-primary ml-2",attrs:{to:"/portfolio/fees/new"}},[r("fa-icon",{attrs:{icon:"plus"}}),r("span",{staticClass:"ml-2"},[t._v("Новая запись")])],1)],1),r("b-col",{attrs:{cols:"auto"}},[t._v(t._s(t._f("roundFloat")(t.total,2))+"₽")])],1),r("b-table",{attrs:{hover:"",striped:"",fields:t.fields,items:t.items},on:{"row-clicked":t.editItem}})],1)},Ot=[],Ct=r("c064"),xt={name:"Fees",components:{BContainer:B["a"],BTable:O["a"],BLink:Ct["a"],BCol:P["a"],BRow:$["a"]},data:function(){return{fields:[{key:"date",label:"Дата",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"amount",label:"Сумма"},{key:"comment",label:"Коментарий"}]}},computed:{items:function(){return this.$store.getters.portfolioFees},total:function(){return this.$store.getters.portfolioFeesTotal}},created:function(){this.$store.dispatch("getPortfolioFees")},methods:{editItem:function(t){this.$router.push({name:"editPortfolioFee",params:{id:t.id}})}}},wt=xt,_t=Object(s["a"])(wt,Pt,Ot,!1,null,"2fcb28a0",null),Tt=_t.exports,Et=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[r("b-row",{staticClass:"mb-2"},[r("b-col",[t._v("\n\t\t\tЦена покупки: "+t._s(t.totalPurchasePrice)+"₽\n\t\t")]),r("b-col",[t._v("\n\t\t\tЦена рыночная: "+t._s(t._f("roundFloat")(t.totalMarketPrice,2))+"₽\n\t\t")]),r("b-col",[r("label",{staticClass:"btn btn-success btn-sm",attrs:{for:"file-import"}},[r("fa-icon",{attrs:{icon:"file-excel"}}),r("span",{staticClass:"ml-2"},[t._v("Импорт из CSV")]),r("input",{ref:"fileimport",staticStyle:{display:"none"},attrs:{id:"file-import",type:"file",accept:".xlsx"},on:{change:t.onFileChange}})],1)])],1),r("b-table",{attrs:{striped:"",hover:"",items:t.items,fields:t.fields},on:{"row-clicked":t.editItem},scopedSlots:t._u([{key:"actions",fn:function(e){return[r("b-link",{attrs:{to:{name:"editPortfolio",params:{id:e.item.id}}}},[t._v("Редактировать")])]}}])})],1)},Ft=[],$t=(r("34ef"),{name:"Orders",components:{BCol:P["a"],BRow:$["a"],BContainer:B["a"],BLink:Ct["a"],BTable:O["a"]},computed:{items:function(){return this.$store.getters.portfolioOrders},totalMarketPrice:function(){return this.$store.getters.portfolioOrdersTotalMarketPrice},totalPurchasePrice:function(){return this.$store.getters.portfolioOrdersTotalPurchasePrice}},data:function(){return{fields:[{key:"secid",label:"Инструмент",formatter:function(){}},{key:"amount",label:"Количество"},{key:"purchaseDate",label:"Дата покупки",formatter:function(t){return v()(t).format("DD.MM.YYYY")}},{key:"price",label:"Цена покупки"},{key:"nkd",label:"НКД"},{key:"totalValue",label:"Стоимость",formatter:function(t,e,r){return r.amount*r.price+r.nkd}},{key:"actions",label:""}]}},created:function(){this.$store.dispatch("getOrders"),this.$store.dispatch("bonds.list"),this.$store.dispatch("shares.list")},methods:{editItem:function(t){this.$router.push({name:"editPortfolioOrder",params:{id:t.id}})},onFileChange:function(t){var e=this,r=!0,a=t.target.files||t.dataTransfer.files;if(a){var o=a[0],n=new FileReader;n.onload=function(t){var a=t.target.result;r||(a=new Uint8Array(a));var o=D.a.read(a,{type:r?"binary":"array"}),n=o.SheetNames[0],s=D.a.utils.sheet_to_json(o.Sheets[n]);e.$store.dispatch("importPortfolioOrders",s)},r?n.readAsBinaryString(o):n.readAsArrayBuffer(o)}}}}),St=$t,Mt=Object(s["a"])(St,Et,Ft,!1,null,"3095dfde",null),Yt=Mt.exports,It=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[r("b-row",{staticClass:"mb-2"},[r("b-col",[t._v("\n\t\t\tЦена рыночная: "+t._s(t._f("roundFloat")(t.totalMarketPrice,2))+"₽\n\t\t")])],1),r("b-table",{attrs:{striped:"",hover:"",fields:t.fields,items:t.items},on:{"row-clicked":t.viewItem}})],1)},At=[],Rt={name:"Securities",components:{BContainer:B["a"],BTable:O["a"]},computed:{items:function(){return this.$store.getters.portfolioSecurities},totalMarketPrice:function(){return this.$store.getters.portfolioOrdersTotalMarketPrice}},data:function(){return{fields:[{key:"name",formatter:function(t,e,r){return r.security.details.SHORTNAME}},{key:"amount"},{key:"marketPrice",formatter:function(t,e,r){return r.security.marketData.MARKETPRICE}},{key:"totalValue",formatter:function(t,e,r){return r.security.marketData.MARKETPRICE*r.amount*r.security.details.FACEVALUE/100}}]}},created:function(){this.$store.dispatch("getOrders"),this.$store.dispatch("bonds.list"),this.$store.dispatch("shares.list")},methods:{viewItem:function(t){this.$router.push({name:"viewPortfolioSecurity",params:{id:t.secid}})}}},zt=Rt,Nt=Object(s["a"])(zt,It,At,!1,null,"08ccde84",null),Ut=Nt.exports,Lt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"portfolio"},[r("b-row",{staticClass:"mb-2"},[r("b-col"),r("b-col",[r("b-nav",{attrs:{pills:""}},t._l(t.listTypes,function(e){return r("b-nav-item",{key:e.value,attrs:{"active-class":"active",to:"/portfolio/"+e.value}},[t._v(t._s(e.text))])}),1)],1),r("b-col")],1),r("router-view")],1)},Vt=[],Kt={name:"Portfolio",components:{BCol:P["a"],BRow:$["a"]},computed:{portfolioTotal:function(){return this.$store.getters.portfolioTotal}},data:function(){return{type:"orders",listTypes:[{value:"orders",text:"Покупки"},{value:"securities",text:"Бумаги"},{value:"fees",text:"Комиссии"}]}},created:function(){},methods:{exportData:function(){var t=this.items;if(0!==t.length){var e=D.a.utils.book_new(),r="Портфель",a=g.a.keys(g.a.first(t)),o=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/,n=[a].concat(Object(b["a"])(g.a.map(t,function(t){return g.a.map(a,function(e){return g.a.isObject(t[e])||g.a.isArray(t[e])?h()(t[e]):g.a.isString(t[e])&&o.test(t[e])?new Date(t[e]):t[e]})}))),s=D.a.utils.aoa_to_sheet(n);D.a.utils.book_append_sheet(e,s,r),D.a.writeFile(e,"".concat(r,".xlsx"))}}}},Gt=Kt,Ht=Object(s["a"])(Gt,Lt,Vt,!1,null,"6436a76e",null),Qt=Ht.exports,qt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[r("div",[r("h2",[t._v(t._s(t.security&&t.security.details.SECNAME))]),r("b-row",[r("b-col",[t._v("Получено: "+t._s(t._f("roundFloat")(t.totalPayments,2))+"₽")]),r("b-col",[t._v("Потрачено: "+t._s(t._f("roundFloat")(t.totalCost,2))+"₽")]),r("b-col",[t._v("Период: "+t._s(t.periodLength)+" дней")]),r("b-col",[t._v("Доходность (годовых): "+t._s(t._f("roundFloat")(t.yieldYearly,2))+"%")])],1)],1),r("b-row",[r("b-col",[r("h2",[t._v("Покупки")]),r("b-table",{attrs:{hover:"",striped:"",fields:t.orderFields,items:t.orders}})],1),r("b-col",[r("h2",[t._v("Выплаты")]),r("b-table",{attrs:{hover:"",striped:"",fields:t.paymentFields,items:t.payments}})],1)],1)],1)},Zt=[],Jt={name:"ViewSecurity",components:{BCol:P["a"],BContainer:B["a"],BTable:O["a"]},data:function(){return{orderFields:[{key:"purchaseDate",label:"Дата",formatter:"dateValue"},{key:"price",label:"Цена"},{key:"amount",label:"Количество"},{key:"total",label:"Итого",formatter:"totalPrice"}],paymentFields:[{key:"date",label:"Дата",formatter:"dateValue"},{key:"type",label:"Тип",formatter:"paymentType"},{key:"value",label:"Выплата за единицу"},{key:"amount",label:"В портфеле"},{key:"total",label:"Итого"}]}},computed:{secid:function(){return this.$route.params.id},security:function(){var t=this.$store.getters.bondsCache[this.secid];return!t||t.payments&&!g.a.isEmpty(t.payments)||this.$store.dispatch("bonds.getPayments",t.id),t||this.$store.getters.sharesCache[this.secid]},orders:function(){var t=this;return g.a.filter(this.$store.getters.portfolioOrders,function(e){return e.secid===t.secid})},period:function(){var t=g.a.minBy(this.orders,function(t){return t.purchaseDate});return t?{from:v()(t.purchaseDate).toDate(),to:new Date}:null},periodLength:function(){return this.period?v()(this.period.to).diff(this.period.from,"days"):0},payments:function(){if(this.security&&"bonds"===this.security.type){var t=this.period;if(t){var e=Z.getBondPaymentsForPeriod({bond:this.security,from:t.from,to:t.to});return Z.calculateOwnershipForPayments({payments:e,orders:this.orders}),e}}return null},totalPayments:function(){return g.a.reduce(this.payments,function(t,e){return t+e.total},0)},totalCost:function(){return g.a.reduce(this.orders,function(t,e){return t+e.amount*e.price+e.nkd},0)},yieldYearly:function(){return this.periodLength?100*this.totalPayments/this.totalCost*365/this.periodLength:0}},created:function(){this.$store.dispatch("bonds.get",this.secid),this.$store.dispatch("shares.get",this.secid),this.$store.dispatch("getOrders")},methods:{dateValue:function(t){return v()(t).format("DD.MM.YYYY")},totalPrice:function(t,e,r){return r.amount*r.price+r.nkd},paymentType:function(t){switch(t){case"coupon":return"Купон";case"amortization":return"Амортизация";default:return t}}}},Xt=Jt,Wt=Object(s["a"])(Xt,qt,Zt,!1,null,"6eab5c28",null),te=Wt.exports,ee=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-container",[t.item?r("b-form",{on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[r("b-form-group",{attrs:{id:"dateGroup",label:"Дата платежа:","label-for":"date"}},[r("datepicker",{attrs:{format:"dd.MM.yyyy",name:"uniquename"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),r("b-form-group",{attrs:{id:"amountGroup",label:"Сумма:","label-for":"amount"}},[r("b-form-input",{attrs:{id:"amount",type:"number",step:"any"},model:{value:t.item.amount,callback:function(e){t.$set(t.item,"amount",t._n(e))},expression:"item.amount"}})],1),r("b-form-group",{attrs:{id:"commentGroup",label:"Коментарий:","label-for":"comment"}},[r("b-form-input",{attrs:{id:"comment",type:"text"},model:{value:t.item.comment,callback:function(e){t.$set(t.item,"comment",e)},expression:"item.comment"}})],1),r("b-button",{staticClass:"mt-4",attrs:{type:"submit",variant:"primary"}},[t._v("Сохранить")])],1):t._e()],1)},re=[],ae={name:"EditFee",components:{BForm:C["a"],BContainer:B["a"],Datepicker:gt["a"]},data:function(){return{item:null}},computed:{id:function(){return this.$route.params.id},date:{get:function(){return v()(this.item.date).toDate()},set:function(t){this.item.date=v()(t,"YYYY-MM-DD").toDate()}}},created:function(){var t=this;this.id?this.$store.dispatch("getPortfolioFee",this.id).then(function(e){t.item=g.a.clone(e)}):this.item={date:new Date,amount:0,comment:null}},methods:{save:function(){var t=this;this.$store.dispatch("savePortfolioFee",this.item).then(function(){t.$router.push("/portfolio/fees")})}}},oe=ae,ne=Object(s["a"])(oe,ee,re,!1,null,"6454a850",null),se=ne.exports,ie={EditOrderPage:Bt,FeesPage:Tt,OrdersPage:Yt,SecuritiesPage:Ut,IndexPage:Qt,ViewSecurityPage:te,EditFeePage:se},ce={Portfolio:ie};a["a"].use(d["a"]);var ue=new d["a"]({routes:[{path:"/bonds",name:"bonds",component:A},{path:"/bonds/:secid/:board",name:"viewBond",component:at},{path:"/portfolio",name:"portfolio",component:ce.Portfolio.IndexPage,children:[{path:"orders",name:"portfolioOrders",component:ce.Portfolio.OrdersPage},{path:"orders/:id",name:"editPortfolioOrder",component:ce.Portfolio.EditOrderPage},{path:"securities",name:"portfolioSecurities",component:ce.Portfolio.SecuritiesPage},{path:"securities/:id",name:"viewPortfolioSecurity",component:ce.Portfolio.ViewSecurityPage},{path:"fees",name:"portfolioFees",component:ce.Portfolio.FeesPage},{path:"fees/new",name:"newPortfolioFee",component:ce.Portfolio.EditFeePage},{path:"fees/:id",name:"editPortfolioFee",component:ce.Portfolio.EditFeePage}]},{path:"/shares",name:"shares",component:dt},{path:"/shares/:secid",name:"viewShare",component:pt},{path:"/",redirect:"/bonds"}]}),de=r("2f62"),le=r("2a74");a["a"].use(de["a"]);var fe=new de["a"].Store({modules:le["default"]}),me=r("9f7b"),he=r.n(me),be=r("ecee"),pe=r("c074"),ve=r("ad3d");r("f9e3"),r("2dd8");be["c"].add(pe["c"],pe["b"],pe["a"]),a["a"].component("fa-icon",ve["a"]),a["a"].use(he.a),a["a"].filter("roundFloat",function(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r}),a["a"].config.productionTip=!1,new a["a"]({router:ue,store:fe,render:function(t){return t(u)}}).$mount("#app")},"5c0b":function(t,e,r){"use strict";var a=r("5e27"),o=r.n(a);o.a},"5e27":function(t,e,r){},6877:function(t,e,r){"use strict";r.r(e);var a=r("795b"),o=r.n(a),n=(r("ac6a"),r("5d73")),s=r.n(n),i=r("2ef0"),c=r.n(i),u=r("2b0e"),d=r("2e70"),l=function(t,e){var r=!0,a=!1,o=void 0;try{for(var n,i=s()(c.a.keys(e));!(r=(n=i.next()).done);r=!0){var d=n.value;u["a"].set(t,d,e[d])}}catch(l){a=!0,o=l}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}},f={};e["default"]={state:{loading:!1,items:[],sharesCache:{},selectedBoard:"TQBR",searchText:"",boards:[],currentPage:1,perPage:20,sortBy:"marketData.MARKETPRICE",sortDesc:!0},getters:{shares:function(t){return t.items},sharesCache:function(t){return t.sharesCache},sharesBoards:function(t){return t.boards}},mutations:{"shares.set":function(t,e){t.items=e},"sharesBoards.set":function(t,e){t.boards=e},"shares.update":function(t,e){t.sharesCache[e.id]?l(t.sharesCache[e.id],e):u["a"].set(t.sharesCache,e.id,e)},"shares.selectedBoard":function(t,e){t.selectedBoard=e},"shares.searchText":function(t,e){t.searchText=e},"shares.currentPage":function(t,e){t.currentPage=e},"shares.perPage":function(t,e){t.perPage=e},"shares.sortBy":function(t,e){t.sortBy=e},"shares.sortDesc":function(t,e){t.sortDesc=e},"shares.loading":function(t,e){t.loading=e}},actions:{changeSharesSelectedBoard:function(t,e){var r=t.commit,a=t.dispatch;r("shares.selectedBoard",e),r("shares.set",[]),f.getShares=null,a("getShares")},getShares:function(t){var e=t.commit,r=t.state;return f.getShares||(f.getShares=new o.a(function(t,a){e("shares.loading",!0),d["a"].getSecuritiesForMarketAndBoard({market:"shares",board:r.selectedBoard}).then(function(t){e("shares.set",t),e("shares.loading",!1)},a)})),f.getShares},getShare:function(t,e){var r=t.state,a=t.commit;return new o.a(function(t,o){return r.sharesCache[e]?t(r.sharesCache[e]):d["a"].getBond(e).then(function(o){return a("shares.update",o),t(r.bondsCache[e])},o)})},getSharesBoards:function(t){var e=t.commit;return f.getBoardsForMarket||(f.getBoardsForMarket=new o.a(function(t,r){d["a"].getBoardsForMarket("shares").then(function(t){e("sharesBoards.set",t)},r)})),f.getBoardsForMarket}}}},9639:function(t,e,r){"use strict";r.r(e);var a=r("795b"),o=r.n(a),n=r("59ad"),s=r.n(n),i=(r("a481"),r("ac6a"),r("5d73")),c=r.n(i),u=r("2b0e"),d=r("2ef0"),l=r.n(d),f=(r("96cf"),r("3b8d")),m=r("74ce"),h=new m["a"]("investment_db");h.version(1).stores({orders:"++id,purchaseDate"}),h.version(2).stores({orders:"++id,purchaseDate",fees:"++id,date"});var b={saveOrder:function(t){return h.orders.put(t).then(function(e){return t.id||(t.id=e),t})},saveOrders:function(t){var e=this;return h.orders.bulkAdd(t).then(function(r){return console.log("Added ".concat(t.length,", last key is ").concat(r)),e.getOrders()})},deleteOrder:function(){var t=Object(f["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",h.orders.delete(e));case 1:case"end":return t.stop()}},t)}));function e(e){return t.apply(this,arguments)}return e}(),getOrders:function(){return h.orders.toArray()},getFees:function(){return h.fees.toArray()},saveFee:function(t){return h.fees.put(t).then(function(e){return t.id||(t.id=e),t})}},p=r("c1df"),v=r.n(p),y=null,g=null,k=function(t,e){var r=!0,a=!1,o=void 0;try{for(var n,s=c()(l.a.keys(e));!(r=(n=s.next()).done);r=!0){var i=n.value;u["a"].set(t,i,e[i])}}catch(d){a=!0,o=d}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}},j=function(t){return l.a.isNumber(t)?t:(t=t.replace(/\s+/g,""),s()(t))};e["default"]={state:{orders:[],ordersCache:{},fees:[],feesCache:{}},getters:{portfolioOrders:function(t){return l.a.orderBy(t.orders,["purchaseDate"],["desc"])},portfolioOrdersCache:function(t){return t.ordersCache},portfolioOrdersTotalMarketPrice:function(t,e){var r=0;return l.a.each(t.orders,function(t){var a=e.bondsCache[t.secid];a&&(r+=t.amount*(a.marketData.MARKETPRICE*a.details.FACEVALUE/100))}),r},portfolioOrdersTotalPurchasePrice:function(t,e){var r=0;return l.a.each(t.orders,function(t){var a=e.bondsCache[t.secid];a&&(r+=t.amount*t.price+t.nkd)}),r},portfolioSecurities:function(t,e){var r=l.a.groupBy(t.orders,function(t){return t.secid});return l.a.map(l.a.keys(r),function(t){var a=r[t],o=e.bondsCache[t]||e.sharesCache[t]||{id:t,details:{},marketData:{}};return{secid:t,security:o,amount:l.a.reduce(a,function(t,e){return t+e.amount},0)}})},portfolioFees:function(t){return l.a.orderBy(t.fees,["date"],["desc"])},portfolioFeesTotal:function(t){return l.a.reduce(t.fees,function(t,e){return t+e.amount},0)}},mutations:{"portfolioOrders.set":function(t,e){t.orders=e,l.a.each(e,function(e){u["a"].set(t.ordersCache,e.id,e)})},"portfolioOrders.add":function(t,e){t.orders.push(e),u["a"].set(t.ordersCache,e.id,e)},"portfolioOrders.update":function(t,e){var r=t.ordersCache[e.id];r?k(r,e):u["a"].set(t.ordersCache,e.id,e)},"portfolioOrders.delete":function(t,e){if(t.ordersCache[e]){var r=l.a.indexOf(t.orders,t.ordersCache[e]);-1!==r&&t.orders.splice(r,1),delete t.ordersCache[e]}},"portfolioFees.set":function(t,e){t.fees=e,l.a.each(e,function(e){u["a"].set(t.feesCache,e.id,e)})},"portfolioFees.update":function(t,e){var r=t.feesCache[e.id];r?k(r,e):(u["a"].set(t.feesCache,e.id,e),t.fees.push(e))}},actions:{getOrders:function(t){var e=t.commit;return y||(y=new o.a(function(t,r){try{b.getOrders().then(function(r){e("portfolioOrders.set",r),t(r)},r)}catch(a){t([])}})),y},addOrder:function(t,e){var r=t.commit,a=e.secid,n=e.market;return new o.a(function(t,e){var o={secid:a,market:n,purchaseDate:new Date,amount:0};b.saveOrder(o).then(function(e){r("portfolioOrders.add",e),t(e)},e)})},getOrder:function(t,e){var r=t.dispatch,a=t.state;return r("getOrders").then(function(){return a.ordersCache[e]})},deleteOrder:function(t,e){var r=t.commit,a=t.state;return a.ordersCache[e]?b.deleteOrder(e).then(function(){r("portfolioOrders.delete",e)}):o.a.reject("Portfolio item with id ".concat(order.id," does not exist"))},updateOrder:function(t,e){var r=t.commit,a=t.state,n=a.ordersCache[e.id];return n?b.saveOrder(e).then(function(t){return r("portfolioOrders.update",t),a.ordersCache[t.id]}):o.a.reject("Portfolio item with id ".concat(e.id," does not exist"))},getPortfolioFees:function(t){var e=t.commit;return g||(g=new o.a(function(t,r){try{b.getFees().then(function(r){e("portfolioFees.set",r),t(r)},r)}catch(a){t([])}})),g},getPortfolioFee:function(t,e){var r=t.dispatch,a=t.state;return r("getPortfolioFees").then(function(){return a.feesCache[e]})},savePortfolioFee:function(t,e){var r=t.commit,a=t.state;return b.saveFee(e).then(function(t){return r("portfolioFees.update",t),a.feesCache[t.id]})},importPortfolioOrders:function(t,e){var r=t.commit,a=l.a.map(e,function(t){return{secid:t.SECID,purchaseDate:v()(t.DATE,"DD.MM.YYYY").toDate(),price:j(t.PRICE),amount:j(t.AMOUNT),nkd:j(t.NKD)}});return b.saveOrders(a).then(function(t){return r("portfolioOrders.set",t),t})}}}},d307:function(t,e,r){var a={"./bonds.js":"1cbc","./index.js":"2a74","./layout.js":"3150","./portfolio.js":"9639","./shares.js":"6877"};function o(t){var e=n(t);return r(e)}function n(t){var e=a[t];if(!(e+1)){var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}return e}o.keys=function(){return Object.keys(a)},o.resolve=n,t.exports=o,o.id="d307"},f898:function(t,e,r){"use strict";var a=r("f9ea"),o=r.n(a);o.a},f9ea:function(t,e,r){}});
//# sourceMappingURL=app.cfaefeb2.js.map